<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <link rel="stylesheet" href="https://miro.com/app/static/styles.1.0.css" />
</head>

<body class="i-am-yellow centered-for-demo">
  <script src="https://miro.com/app/static/sdk.1.1.js"></script>
  <script src="main.js"></script>

  <div class="miro-h2">Settings</div>

  <div class="miro-input-field miro-input-field--small">
    <label>codeBeamer Address</label>
    <input id='cbAddress' type="text" class="miro-input miro-input--primary"
      placeholder="e.g. https://codebeamer.com/cb">
  </div>
  <div class="miro-input-field miro-input-field--small">
    <label>Inbox Tracker ID</label>
    <input id='inboxTrackerId' type="number" class="miro-input miro-input--primary" placeholder="e.g. 12345">
  </div>
  <div class="miro-input-field miro-input-field--small">
    <label>codeBeamer Username</label>
    <input id='cbUsername' type="text" class="miro-input miro-input--primary" placeholder="Username">
  </div>
  <div class="miro-input-field miro-input-field--small">
    <label>codeBeamer Password</label>
    <input id='cbPassword' type="password" class="miro-input miro-input--primary" placeholder="**********">
  </div>

  <button id='saveButton' class="miro-btn miro-btn--primary miro-btn--small">Save</button>
  <script>
    function setFieldFromPrivateSettings(fieldIdAndSettingName) {
      return getPrivateSetting(fieldIdAndSettingName).then(value => {
        if (value)
          document.querySelector(`#${fieldIdAndSettingName}`).value = value
      })
    }

    function setFieldFromBoardSettings(fieldIdAndSettingName) {
      return getBoardSetting(fieldIdAndSettingName).then(value => {
        if (value)
          document.querySelector(`#${fieldIdAndSettingName}`).value = value
      })
    }

    function addValueOfFieldToObject(object, fieldId) {
      object[fieldId] = document.querySelector(`#${fieldId}`).value
      return object
    }

    document.querySelector('#saveButton').addEventListener('click', () => {
      boardSettings = {}
      addValueOfFieldToObject(boardSettings, 'cbAddress')
      addValueOfFieldToObject(boardSettings, 'inboxTrackerId')
      privateSettings = {}
      addValueOfFieldToObject(privateSettings, 'cbUsername')
      addValueOfFieldToObject(privateSettings, 'cbPassword')

      return Promise.all([
        saveBoardSettings(boardSettings),
        savePrivateSettings(privateSettings)
      ])
    })

    onReady(() => {
      setFieldFromBoardSettings('cbAddress')
      setFieldFromBoardSettings('inboxTrackerId')
      setFieldFromPrivateSettings('cbUsername')
      setFieldFromPrivateSettings('cbPassword')
    })

  </script>
</body>

</html>